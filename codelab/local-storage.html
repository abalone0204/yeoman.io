<!DOCTYPE html><html lang=en><head><meta charset=utf-8><title>Yeoman - Modern workflows for modern webapps</title><meta name=viewport content="width=device-width"><link href="http://fonts.googleapis.com/css?family=Roboto+Slab:400,700|Roboto:400,700,700italic,400italic" rel=stylesheet><link rel=stylesheet href=/static/bundle-4964.138cb6b273.css><link href=/blog/atom.xml type=application/atom+xml rel=alternate title="Yeoman Blog Atom Feed"><link rel="shortcut icon" href=../static/favicon.b25e58c4b8.ico></head><body><header class=page-header><div class=container><div class=mobile-bar><h1 class=logo><a href="/"><img src=/static/logo.f0661e3819.png alt=Yeoman></a></h1><button class="mobile-menu-toggle ir">open</button></div><nav class=main-menu><ul class=main-nav><li><a href="/learning/">Using Yeoman</a><ul> <li><a href=/learning/index.html>Getting started</a></li> <li><a href=/codelab.html>Tutorial (codelab)</a></li> <li><a href=/learning/resources.html>Resources</a></li> <li><a href=/learning/deployment.html>Deployment</a></li> <li><a href=/learning/faq.html>FAQ</a></li> <li><a href=/learning/support.html>Support</a></li></ul></li><li><a href="/generators/">Discovering generators</a></li> <li><a href="/authoring/">Creating a generator</a><ul> <li><a href=/authoring/index.html>Getting started</a></li> <li><a href=/authoring/running-context.html>Running Context</a></li> <li><a href=/authoring/user-interactions.html>User Interactions</a></li> <li><a href=/authoring/composability.html>Composability</a></li> <li><a href=/authoring/dependencies.html>Managing Dependencies</a></li> <li><a href=/authoring/file-system.html>Interacting with the file system</a></li> <li><a href=/authoring/gruntfile.html>Creating a Gruntfile</a></li> <li><a href=/authoring/storage.html>Storing user configs</a></li> <li><a href=/authoring/testing.html>Unit testing</a></li> <li><a href=/authoring/debugging.html>Debugging Generators</a></li> <li><a href=/authoring/integrating-yeoman.html>Integrating Yeoman in other tools</a></li> <li><a href="http://yeoman.github.io/generator/">Full API documentation</a></li></ul></li><li><a href="/blog/">Blog</a></li> <li><a href="/contributing/">Contributing</a><ul> <li><a href=/contributing/index.html>Contributing</a></li> <li><a href=/contributing/opening-issues.html>How to open an issue</a></li> <li><a href=/contributing/pull-request.html>How to submit a PR</a></li> <li><a href=/contributing/style-guide.html>Style Guide</a></li> <li><a href=/contributing/testing-guidelines.html>Testing Guidelines</a></li> <li><a href=/contributing/ticketing.html>Issue system overview</a></li></ul></li></ul></nav></div></header><div id=content><h2 class=page-title><div class=container></div></h2><div class="container has-sidebar clearfix"><nav class=context-nav><ul><li><a href=/codelab.html>Let's Scaffold a Web App</a></li> <li><a href=/codelab/meet-yeoman.html>Meet Yeoman</a></li> <li><a href=/codelab/setup.html>Step 1</a></li> <li><a href=/codelab/install-generators.html>Step 2</a></li> <li><a href=/codelab/scaffold-app.html>Step 3</a></li> <li><a href=/codelab/review-generated-files.html>Step 4</a></li> <li><a href=/codelab/preview-inbrowser.html>Step 5</a></li> <li><a href=/codelab/write-app.html>Step 6</a></li> <li><a href=/codelab/install-packages.html>Step 7</a></li> <li><a href=/codelab/write-unit-tests.html>Step 8</a></li> <li><a href=/codelab/prepare-production.html>Step 9</a></li> <li><a href=/codelab/local-storage.html class=active>Step 10</a></li> <li><a href=/codelab/keep-going.html>Keep going</a></li></ul></nav><article class=main><section class=content-chunk><h1>Step 10: Make Todos persistent with local storage</h1><p>Let’s revisit the issue of items not persisting when the browser refreshes.</p><div class="note tip">If you had no issues with Step 7 and you're short on time, you can skip to the <a href=keep-going.html>codelab wrapup</a>.</div><h2>Install Bower package</h2><p>To easily achieve this we can use another Angular module called "<a href=http://gregpike.net/demos/angular-local-storage/demo/demo.html>angular-local-storage</a>" that will allow us to quickly implement <a href=http://diveintohtml5.info/storage.html>local storage</a>. Again, Bower comes to the rescue.</p><p>Run the following command:</p><div class=highlight><pre><code class=language-sh data-lang=sh>bower install --save angular-local-storage
</code></pre></div><p><img src=/static/image_29.5c5212e4a2.png alt=""></p><h2>Add local storage</h2><p>Similar to how we added jQueryUI and AngularUI Sortable in <a href=install-packages.html#implement>Step 7</a> to make todos sortable, we need to add a reference to the <em>angular-local-storage.js</em> file in <em>index.html</em>.</p><p>Since we're using <em>bower.json</em> to keep track of our modules, <span class=keyboard>Ctrl</span>+<span class=keyboard>C</span> to exit the current command line process, then re-run <code>grunt serve</code> to get some automated magic in your <em>index.html</em>.</p><p>At the bottom of <em>index.html</em>, this should have been added:</p><div class=highlight><pre><code class=language-html data-lang=html><span class=nt>&lt;script </span><span class=na>src=</span><span class=s>"bower_components/angular-local-storage/dist/angular-local-storage.js"</span><span class=nt>&gt;&lt;/script&gt;</span>
</code></pre></div><p>Your <em>index.html</em> scripts block should now look like this:</p><div class=highlight><pre><code class=language-html data-lang=html><span class=c>&lt;!-- build:js scripts/vendor.js --&gt;</span>
<span class=c>&lt;!-- bower:js --&gt;</span>
<span class=nt>&lt;script </span><span class=na>src=</span><span class=s>"bower_components/jquery/dist/jquery.js"</span><span class=nt>&gt;&lt;/script&gt;</span>
<span class=nt>&lt;script </span><span class=na>src=</span><span class=s>"bower_components/angular/angular.js"</span><span class=nt>&gt;&lt;/script&gt;</span>
<span class=nt>&lt;script </span><span class=na>src=</span><span class=s>"bower_components/bootstrap/dist/js/bootstrap.js"</span><span class=nt>&gt;&lt;/script&gt;</span>
<span class=nt>&lt;script </span><span class=na>src=</span><span class=s>"bower_components/angular-resource/angular-resource.js"</span><span class=nt>&gt;&lt;/script&gt;</span>
<span class=nt>&lt;script </span><span class=na>src=</span><span class=s>"bower_components/angular-cookies/angular-cookies.js"</span><span class=nt>&gt;&lt;/script&gt;</span>
<span class=nt>&lt;script </span><span class=na>src=</span><span class=s>"bower_components/angular-sanitize/angular-sanitize.js"</span><span class=nt>&gt;&lt;/script&gt;</span>
<span class=nt>&lt;script </span><span class=na>src=</span><span class=s>"bower_components/angular-animate/angular-animate.js"</span><span class=nt>&gt;&lt;/script&gt;</span>
<span class=nt>&lt;script </span><span class=na>src=</span><span class=s>"bower_components/angular-touch/angular-touch.js"</span><span class=nt>&gt;&lt;/script&gt;</span>
<span class=nt>&lt;script </span><span class=na>src=</span><span class=s>"bower_components/angular-route/angular-route.js"</span><span class=nt>&gt;&lt;/script&gt;</span>
<span class=nt>&lt;script </span><span class=na>src=</span><span class=s>"bower_components/jquery-ui/ui/jquery-ui.js"</span><span class=nt>&gt;&lt;/script&gt;</span>
<span class=nt>&lt;script </span><span class=na>src=</span><span class=s>"bower_components/angular-ui-sortable/sortable.js"</span><span class=nt>&gt;&lt;/script&gt;</span>
<span class=nt>&lt;script </span><span class=na>src=</span><span class=s>"bower_components/angular-local-storage/dist/angular-local-storage.js"</span><span class=nt>&gt;&lt;/script&gt;</span>
<span class=c>&lt;!-- endbower --&gt;</span>
<span class=c>&lt;!-- endbuild --&gt;</span>
</code></pre></div><p>Edit the <code>mytodoApp</code> application module (<em>scripts/app.js</em>) to include the <code>LocalStorageModule</code> adapter:</p><div class=highlight><pre><code class=language-js data-lang=js><span class=nx>angular</span>
  <span class=p>.</span><span class=nx>module</span><span class=p>(</span><span class=s1>'mytodoApp'</span><span class=p>,</span> <span class=p>[</span>
    <span class=s1>'ngAnimate'</span><span class=p>,</span>
    <span class=s1>'ngCookies'</span><span class=p>,</span>
    <span class=s1>'ngResource'</span><span class=p>,</span>
    <span class=s1>'ngRoute'</span><span class=p>,</span>
    <span class=s1>'ngSanitize'</span><span class=p>,</span>
    <span class=s1>'ngTouch'</span><span class=p>,</span>
    <span class=s1>'ui.sortable'</span><span class=p>,</span>
    <span class=s1>'LocalStorageModule'</span>
<span class=p>])</span>
</code></pre></div><p>While you’re in <em>app.js</em>, also configure <code>localStorageServiceProvider</code> to use <code>"ls"</code> as a localStorage name prefix so your app doesn’t accidently read todos from another app using the same variable names:</p><div class=highlight><pre><code class=language-js data-lang=js><span class=p>.</span><span class=nx>config</span><span class=p>([</span><span class=s1>'localStorageServiceProvider'</span><span class=p>,</span> <span class=kd>function</span><span class=p>(</span><span class=nx>localStorageServiceProvider</span><span class=p>){</span>
  <span class=nx>localStorageServiceProvider</span><span class=p>.</span><span class=nx>setPrefix</span><span class=p>(</span><span class=s1>'ls'</span><span class=p>);</span>
<span class=p>}])</span>
</code></pre></div><p>Our application module should now look like this:</p><div class=highlight><pre><code class=language-js data-lang=js><span class=s1>'use strict'</span><span class=p>;</span>

<span class=nx>angular</span>
  <span class=p>.</span><span class=nx>module</span><span class=p>(</span><span class=s1>'mytodoApp'</span><span class=p>,</span> <span class=p>[</span>
    <span class=s1>'ngAnimate'</span><span class=p>,</span>
    <span class=s1>'ngCookies'</span><span class=p>,</span>
    <span class=s1>'ngResource'</span><span class=p>,</span>
    <span class=s1>'ngRoute'</span><span class=p>,</span>
    <span class=s1>'ngSanitize'</span><span class=p>,</span>
    <span class=s1>'ngTouch'</span><span class=p>,</span>
    <span class=s1>'ui.sortable'</span><span class=p>,</span>
    <span class=s1>'LocalStorageModule'</span>
  <span class=p>])</span>
  <span class=p>.</span><span class=nx>config</span><span class=p>([</span><span class=s1>'localStorageServiceProvider'</span><span class=p>,</span> <span class=kd>function</span><span class=p>(</span><span class=nx>localStorageServiceProvider</span><span class=p>){</span>
    <span class=nx>localStorageServiceProvider</span><span class=p>.</span><span class=nx>setPrefix</span><span class=p>(</span><span class=s1>'ls'</span><span class=p>);</span>
  <span class=p>}])</span>
  <span class=p>.</span><span class=nx>config</span><span class=p>(</span><span class=kd>function</span> <span class=p>(</span><span class=nx>$routeProvider</span><span class=p>)</span> <span class=p>{</span>
    <span class=nx>$routeProvider</span>
      <span class=p>.</span><span class=nx>when</span><span class=p>(</span><span class=s1>'/'</span><span class=p>,</span> <span class=p>{</span>
        <span class=nx>templateUrl</span><span class=o>:</span> <span class=s1>'views/main.html'</span><span class=p>,</span>
        <span class=nx>controller</span><span class=o>:</span> <span class=s1>'MainCtrl'</span>
      <span class=p>})</span>
      <span class=p>.</span><span class=nx>when</span><span class=p>(</span><span class=s1>'/about'</span><span class=p>,</span> <span class=p>{</span>
        <span class=nx>templateUrl</span><span class=o>:</span> <span class=s1>'views/about.html'</span><span class=p>,</span>
        <span class=nx>controller</span><span class=o>:</span> <span class=s1>'AboutCtrl'</span>
      <span class=p>})</span>
      <span class=p>.</span><span class=nx>otherwise</span><span class=p>({</span>
        <span class=nx>redirectTo</span><span class=o>:</span> <span class=s1>'/'</span>
      <span class=p>});</span>
  <span class=p>});</span>
</code></pre></div><p>You will also need to update your controller (<em>main.js</em>) to declare a dependency on the localStorage service. Add <code>localStorageService</code> as the second parameter in the callback function.</p><div class=highlight><pre><code class=language-js data-lang=js><span class=s1>'use strict'</span><span class=p>;</span>

<span class=nx>angular</span><span class=p>.</span><span class=nx>module</span><span class=p>(</span><span class=s1>'mytodoApp'</span><span class=p>)</span>
  <span class=p>.</span><span class=nx>controller</span><span class=p>(</span><span class=s1>'MainCtrl'</span><span class=p>,</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>$scope</span><span class=p>,</span> <span class=nx>localStorageService</span><span class=p>)</span> <span class=p>{</span>
    <span class=c1>// (code hidden here to save space)</span>
  <span class=p>});</span>
</code></pre></div><p>So now, rather than reading our todos from a static array, we’ll be reading it from local storage and then storing it in <code>$scope.todos</code> instead.</p><p>We’ll also use the angular <a href=https://docs.angularjs.org/api/ng/type/$rootScope.Scope#methods_$watch><code>$watch</code></a> listener to watch for changes in the value of <code>$scope.todos</code>. If someone adds or removes a todo, it will then keep our local storage <code>todos</code> datastore in sync.</p><p>Therefore, we need to remove the current <code>$scope.todos</code> declaration:</p><div class=highlight><pre><code class=language-js data-lang=js><span class=nx>$scope</span><span class=p>.</span><span class=nx>todos</span> <span class=o>=</span> <span class=p>[];</span>
</code></pre></div><p>And replace it with this:</p><div class=highlight><pre><code class=language-js data-lang=js><span class=kd>var</span> <span class=nx>todosInStore</span> <span class=o>=</span> <span class=nx>localStorageService</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>'todos'</span><span class=p>);</span>

<span class=nx>$scope</span><span class=p>.</span><span class=nx>todos</span> <span class=o>=</span> <span class=nx>todosInStore</span> <span class=o>||</span> <span class=p>[];</span>

<span class=nx>$scope</span><span class=p>.</span><span class=nx>$watch</span><span class=p>(</span><span class=s1>'todos'</span><span class=p>,</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
  <span class=nx>localStorageService</span><span class=p>.</span><span class=nx>set</span><span class=p>(</span><span class=s1>'todos'</span><span class=p>,</span> <span class=nx>$scope</span><span class=p>.</span><span class=nx>todos</span><span class=p>);</span>
<span class=p>},</span> <span class=kc>true</span><span class=p>);</span>
</code></pre></div><p>We now have a controller that is as follows:</p><div class=highlight><pre><code class=language-js data-lang=js><span class=s1>'use strict'</span><span class=p>;</span>

<span class=nx>angular</span><span class=p>.</span><span class=nx>module</span><span class=p>(</span><span class=s1>'mytodoApp'</span><span class=p>)</span>
  <span class=p>.</span><span class=nx>controller</span><span class=p>(</span><span class=s1>'MainCtrl'</span><span class=p>,</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>$scope</span><span class=p>,</span> <span class=nx>localStorageService</span><span class=p>)</span> <span class=p>{</span>

    <span class=kd>var</span> <span class=nx>todosInStore</span> <span class=o>=</span> <span class=nx>localStorageService</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>'todos'</span><span class=p>);</span>

    <span class=nx>$scope</span><span class=p>.</span><span class=nx>todos</span> <span class=o>=</span> <span class=nx>todosInStore</span> <span class=o>||</span> <span class=p>[];</span>

    <span class=nx>$scope</span><span class=p>.</span><span class=nx>$watch</span><span class=p>(</span><span class=s1>'todos'</span><span class=p>,</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
      <span class=nx>localStorageService</span><span class=p>.</span><span class=nx>set</span><span class=p>(</span><span class=s1>'todos'</span><span class=p>,</span> <span class=nx>$scope</span><span class=p>.</span><span class=nx>todos</span><span class=p>);</span>
    <span class=p>},</span> <span class=kc>true</span><span class=p>);</span>

    <span class=nx>$scope</span><span class=p>.</span><span class=nx>addTodo</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
      <span class=nx>$scope</span><span class=p>.</span><span class=nx>todos</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>$scope</span><span class=p>.</span><span class=nx>todo</span><span class=p>);</span>
      <span class=nx>$scope</span><span class=p>.</span><span class=nx>todo</span> <span class=o>=</span> <span class=s1>''</span><span class=p>;</span>
    <span class=p>};</span>

    <span class=nx>$scope</span><span class=p>.</span><span class=nx>removeTodo</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>index</span><span class=p>)</span> <span class=p>{</span>
      <span class=nx>$scope</span><span class=p>.</span><span class=nx>todos</span><span class=p>.</span><span class=nx>splice</span><span class=p>(</span><span class=nx>index</span><span class=p>,</span> <span class=mi>1</span><span class=p>);</span>
    <span class=p>};</span>

  <span class=p>});</span>
</code></pre></div><p>If you look at your app in the browser now you’ll see that there are no items in the todo list. The app is initialising the todos array from local storage and we haven’t given it any todo items yet.</p><p><img src=/static/image_30.b5a20eda87.png alt=""></p><p>Go ahead and add a few items to the list:</p><p><img src=/static/image_31.3584ba5d10.png alt=""></p><p>Now when we refresh our browser the items persist. Hooray!</p><p>We can confirm whether our data is being persisted to local storage by checking the <strong>Resources</strong> panel in Chrome DevTools and selecting <strong>Local Storage</strong> from the lefthand side:</p><p><img src=/static/image_32.8e95e67a99.png alt=""></p><div class="note tip"><h2>Write unit tests</h2><p>For an extra challenge, revisit unit testing in <a href=write-unit-tests.html>Step 8</a> and consider how you might update your tests now that the code is using local storage.</p><p>Tip: It's not a straight forward answer and involves knowing about mock services. Check out <a href=http://andyshora.com/unit-testing-best-practices-angularjs.html>Unit Testing Best Practices in AngularJS</a>, specifically the <em>Mocking Services and Modules in AngularJS</em> section.</p><h2>Fix the ng-repeat issue</h2><p>For an extra challenge, the ng-repeat function does not accept multiple items with the same value. Try fixing this by looking into "track by" and see if you can get it to work. There is also a bubbling issue that needs to be solved when you use this type of ng-repeat.</p></div><p class=codelab-paging><a href=../codelab.html#toc>« Return to overview</a> or <a href=keep-going.html>You're done! Keep going »</a></p><div class=social><a href=https://twitter.com/share class=twitter-share-button data-text="Let's Scaffold A Web App With @Yeoman!" data-url=http://yeoman.io/codelab.html>Tweet</a><script>!function(t,e,r){var n,s=t.getElementsByTagName(e)[0],i=/^http:/.test(t.location)?"http":"https";t.getElementById(r)||(n=t.createElement(e),n.id=r,n.src=i+"://platform.twitter.com/widgets.js",s.parentNode.insertBefore(n,s))}(document,"script","twitter-wjs");</script><script src=https://apis.google.com/js/plusone.js></script><g:plus action=share></g:plus></div></section></article></div></div><footer class=page-footer><ul class="footer-links footer-links-social"><li><a href=https://plus.google.com/101063139999404044459/posts class=icon><img src=/static/social-gplus.cdac08228d.svg alt=Google+></a></li> <li><a href=https://twitter.com/yeoman class=icon><img src=/static/social-twitter.60eb981a15.svg alt=Twitter></a></li> <li><a href=https://github.com/yeoman/yeoman class=icon><img src=/static/social-github.767995ad17.svg alt=Github></a></li> <li><a href=/blog/atom.xml class=icon><img src=/static/social-feed.c635057faf.svg alt=Feed></a></li></ul><ul class="footer-links footer-links-contribute"><li><a href="http://yeoman.github.io/generator/" class=btn>API</a></li> <li><a href=https://github.com/yeoman/yeoman.io/blob/master/app/codelab/local-storage.md class="btn btn-improve" title="Edit this page on Github to help improve the site">Improve this page</a></li></ul></footer><script src=//ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js></script><script src=/static/bundle-5023.1da2509d57.js async></script><script>!function(t,e,n){"undefined"!=typeof n.module&&n.module.exports?n.module.exports=e():"undefined"!=typeof n.define&&"function"==n.define&&n.define.amd?define(t,e):n[t]=e()}("$script",function(){function t(t,e){for(var n=0,o=t.length;o>n;++n)if(!e(t[n]))return l;return 1}function e(e,n){t(e,function(t){return!n(t)})}function n(i,c,l){function p(t){return t.call?t():s[t]}function g(){if(!--w){s[y]=1,v&&v();for(var n in f)t(n.split("|"),p)&&!e(f[n],p)&&(f[n]=[])}}i=i[m]?i:[i];var h=c&&c.call,v=h?c:l,y=h?i.join(""):c,w=i.length;return setTimeout(function(){e(i,function(t){return d[t]?(y&&(u[y]=1),2==d[t]&&g()):(d[t]=1,y&&(u[y]=1),o(!a.test(t)&&r?r+t+".js":t,g),void 0)})},0),n}function o(t,e){var n=i.createElement("script"),o=l;n.onload=n.onerror=n[v]=function(){n[g]&&!/^c|loade/.test(n[g])||o||(n.onload=n[v]=null,o=1,d[t]=2,e())},n.async=1,n.src=t,c.insertBefore(n,c.firstChild)}var r,i=document,c=i.getElementsByTagName("head")[0],a=/^https?:\/\//,s={},u={},f={},d={},l=!1,m="push",p="DOMContentLoaded",g="readyState",h="addEventListener",v="onreadystatechange";return!i[g]&&i[h]&&(i[h](p,function y(){i.removeEventListener(p,y,l),i[g]="complete"},l),i[g]="loading"),n.get=o,n.order=function(t,e,o){!function r(i){i=t.shift(),t.length?n(i,r):n(i,e,o)}()},n.path=function(t){r=t},n.ready=function(o,r,i){o=o[m]?o:[o];var c=[];return!e(o,function(t){s[t]||c[m](t)})&&t(o,function(t){return s[t]})?r():!function(t){f[t]=f[t]||[],f[t][m](r),i&&i(c)}(o.join("|")),n},n},this);var _gaq=[["_setAccount","UA-32956520-1"],["_setDomainName",".yeoman.io"],["_trackPageview"],["_trackPageLoadTime"]];$script("http://www.google-analytics.com/ga.js"),$script("https://apis.google.com/js/plusone.js"),$script("//platform.twitter.com/widgets.js");</script></body></html>